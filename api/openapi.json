{
  "openapi": "3.0.0",
  "info": {
    "title": "Kontra API",
    "version": "1.0.0"
  },
  "paths": {
    "/api/loans": {
      "post": {
        "summary": "Create a new loan",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "borrower_name": {"type": "string"},
                  "amount": {"type": "number"},
                  "interest_rate": {"type": "number"},
                  "term_months": {"type": "integer"},
                  "start_date": {"type": "string", "format": "date"}
                },
                "required": ["borrower_name","amount","interest_rate","term_months","start_date"]
              }
            }
          }
        },
        "responses": {
          "201": {"description": "Created"}
        }
      }
    },
    "/api/loans/{loanId}/payments": {
      "post": {
        "summary": "Record a payment",
        "parameters": [{"in":"path","name":"loanId","required":true,"schema":{"type":"integer"}}],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "amount": {"type": "number"},
                  "date": {"type": "string", "format": "date"}
                },
                "required": ["amount","date"]
              }
            }
          }
        },
        "responses": {
          "201": {"description": "Created"}
        }
      }
    },
        "/api/loans/{loanId}/balance": {
      "get": {
        "summary": "Get loan balance",
        "parameters": [{"in":"path","name":"loanId","required":true,"schema":{"type":"integer"}}],
        "responses": {"200":{"description":"OK"}}
      }
    },
    "/api/loans/{loanId}/payoff": {
      "post": {
        "summary": "Calculate payoff amount",
        "parameters": [{"in":"path","name":"loanId","required":true,"schema":{"type":"integer"}}],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {"type":"object","properties":{"payoff_date":{"type":"string","format":"date"}},"required":["payoff_date"]}
            }
          }
        },
        "responses": {"200":{"description":"OK"}}
      }
    },
    "/api/bookings": {
      "get": {"summary": "List bookings","responses":{"200":{"description":"OK"}}},
      "post": {
        "summary": "Create a booking",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "guest_id": {"type": "integer"},
                  "room": {"type": "string"},
                  "start_date": {"type": "string", "format": "date"},
                  "end_date": {"type": "string", "format": "date"}
                },
                "required": ["guest_id","room","start_date","end_date"]
              }
            }
          }
        },
        "responses": {"201":{"description":"Created"}}
      }
    },
    "/api/bookings/{id}": {
      "get": {
        "summary": "Get a booking",
        "parameters": [{"in":"path","name":"id","required":true,"schema":{"type":"integer"}}],
        "responses": {"200":{"description":"OK"}}
              },
      "patch": {
        "summary": "Update a booking",
        "parameters": [{"in":"path","name":"id","required":true,"schema":{"type":"integer"}}],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "start_date": {"type":"string","format":"date"},
                  "end_date": {"type":"string","format":"date"}
                }
              }
            }
          }
        },
        "responses": {"200":{"description":"OK"}}
      }
    },
    "/api/webhooks": {
      "get": {"summary": "List registered webhooks","responses":{"200":{"description":"OK"}}},
      "post": {
        "summary": "Register a webhook",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "event": {"type": "string"},
                  "url": {"type": "string", "format": "uri"}
                },
                "required": ["event","url"]
              }
            }
          }
        },
        "responses": {"201":{"description":"Created"}}
      },
      "delete": {
        "summary": "Remove a webhook",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {"type":"object","properties":{"event":{"type":"string"},"url":{"type":"string","format":"uri"}},"required":["event","url"]}
            }
          }
        },
        "responses": {"200":{"description":"Removed"}}
      }
    },
        "/api/trades": {
      "post": {
        "summary": "Submit a trade order",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
             "schema": { "$ref": "#/components/schemas/TradeInput" },
              "example": {
                "trade_type": "repo",
                "notional_amount": 1000,
                "symbol": "AAPL",
                "quantity": 10,
                "price": 150,
                "side": "buy",
                 "counterparties": ["0xCP1"],
                "counterparty_profiles": [
                  {
                    "wallet_address": "0xCP1",
                    "jurisdiction": "US",
                    "investor_type": "institutional",
                    "kycApproved": true
                  }
                ]
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Created",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "trade": { "$ref": "#/components/schemas/Trade" }
                  }
                  },
                "example": {
                  "trade": {
                    "id": 1,
                    "trade_type": "repo",
                    "notional_amount": 1000,
                    "symbol": "AAPL",
                    "quantity": 10,
                    "price": 150,
                    "side": "buy",
                       "counterparties": ["0xCP1"],
                    "counterparty_profiles": [
                      {
                        "wallet_address": "0xCP1",
                        "jurisdiction": "US",
                        "investor_type": "institutional",
                        "kycApproved": true
                      }
                    ],
                    "status": "pending",
                    "created_at": "2024-01-01T00:00:00.000Z"
                  }       
                }
              }
            }
          }
        }
      },
      "get": {
        "summary": "List or filter trades",
        "parameters": [
          { "in": "query", "name": "status", "schema": { "type": "string" } },
            { "in": "query", "name": "trade_type", "schema": { "type": "string" } }
        ],
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "trades": {
                      "type": "array",
                      "items": { "$ref": "#/components/schemas/Trade" }
                    }
                  }
                },
                "example": {
                  "trades": [
                    {
                      "id": 1,
                      "trade_type": "repo",
                      "notional_amount": 1000,
                      "symbol": "AAPL",
                      "quantity": 10,
                      "price": 150,
                      "side": "buy",
                      "counterparties": ["CP-1"],
                      "status": "pending",
                      "created_at": "2024-01-01T00:00:00.000Z"
                    }
                  ]              
                }
              }
            }
          }
        }
      }
    },
        "/api/trades/compliance": {
      "get": {
        "summary": "Get trading compliance policy",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "example": {
                  "policy": {
                    "paused": false,
                    "kycProvider": { "name": "Sumsub", "amlProvider": "Dow Jones PEP/Sanctions" },
                    "issuancePartner": { "name": "Securitize", "services": ["ATS onboarding", "transfer restriction legends"] },
                    "walletWhitelist": { "enforced": true, "requiresVerification": true, "registrySize": 4 },
                    "restrictedJurisdictions": ["IR", "KP"],
                    "restrictedInvestorTypes": ["sanctioned", "unaccredited"],
                    "whitelist": [
                      { "wallet_address": "0xCP1", "jurisdiction": "US", "investor_type": "institutional", "verified": true }
                    ]
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/trades/{id}/settle": {
      "post": {
        "summary": "Finalize a trade",
        "parameters": [
          { "in": "path", "name": "id", "required": true, "schema": { "type": "integer" } }
        ],
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "trade": { "$ref": "#/components/schemas/Trade" }
                  }
                      },
                "example": {
                  "trade": {
                    "id": 1,
                    "trade_type": "repo",
                    "notional_amount": 1000,
                    "symbol": "AAPL",
                    "quantity": 10,
                    "price": 150,
                    "side": "buy",
                    "counterparties": ["CP-1"],
                    "status": "settled",
                    "created_at": "2024-01-01T00:00:00.000Z",
                    "updated_at": "2024-01-02T00:00:00.000Z"
                  }            
                }
              }
            }
          }
        }
      }
    },
    "/api/integrations": {
      "get": {"summary":"List connected integrations","responses":{"200":{"description":"OK"}}}
    },
    "/api/integrations/{name}/connect": {
      "post": {
        "summary": "Connect an integration",
        "parameters": [{"in":"path","name":"name","required":true,"schema":{"type":"string"}}],
        "responses": {"200":{"description":"Connected"}}
      }
          },
        "/api/pci-scan": {"post": {"summary": "Run PCI compliance scan","responses": {"200": {"description": "OK"}}}},
      "/api/kyc": {"get": {"summary": "Run KYC check","responses": {"200": {"description": "OK"}}}},
    "/api/gdpr-export/{userId}": {"get": {"summary": "Export user data","parameters": [{"in":"path","name":"userId","required":true,"schema":{"type":"string"}}],"responses": {"200": {"description": "OK"}}}},
    "/api/gdpr-delete/{userId}": {"delete": {"summary": "Delete user data","parameters": [{"in":"path","name":"userId","required":true,"schema":{"type":"string"}}],"responses": {"200": {"description": "Deleted"}}}},
    "/api/regulatory-scan": {"post": {"summary": "Scan document for compliance","responses": {"200": {"description": "OK"}}}},
      "/api/otp/request": {"post": {"summary": "Request OTP","responses": {"200": {"description": "Sent"}}}},
    "/api/otp/verify": {"post": {"summary": "Verify OTP","responses": {"200": {"description": "Result"}}}},    
    "/api/evidence-dossier/{loanId}": {"get": {"summary": "Gather compliance evidence","parameters": [{"in":"path","name":"loanId","required":true,"schema":{"type":"integer"}}],"responses": {"200": {"description": "OK"}}}},
    "/api/hazard-loss": {
      "post": {
        "summary": "Record hazard loss details",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "draw_id": {"type": "integer"},
                  "part_i": {"type": "object"},
                  "follow_up": {"type": "object"},
                  "restoration": {"type": "object"}
                },
                "required": ["draw_id","part_i"]
              }
            }
          }
        },
        "responses": {"201":{"description":"Created"}}
      }
   },
    "/api/projects": {
      "get": {"summary": "List projects","responses": {"200": {"description": "OK"}}},
      "post": {"summary": "Create a project","responses": {"201": {"description": "Created"}}}
    },
    "/api/draw-request": {
      "post": {"summary": "Submit a draw request","responses": {"200": {"description": "Submitted"}}}
       },
    "/api/room-blocks": {
      "get": {"summary": "List room blocks","responses": {"200": {"description": "OK"}}},
      "post": {
        "summary": "Create a room block",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "rooms": {"type": "string"},
                  "start_date": {"type": "string", "format": "date"},
                  "end_date": {"type": "string", "format": "date"},
                  "reason": {"type": "string"}
                },
                "required": ["rooms","start_date","end_date"]
              }
            }
          }
        },
        "responses": {"201": {"description": "Created"}}
      }
    },
    "/api/hospitality/forecast": {
      "get": {"summary": "Occupancy and revenue forecast","responses": {"200": {"description": "OK"}}}
          }
       "/api/reports/run": {"post": {"summary": "Execute ad hoc report","responses": {"200": {"description": "OK"}}}},
    "/api/reports/schedule": {"post": {"summary": "Schedule report delivery","responses": {"201": {"description": "Created"}}}},
       "/api/reports/save": {"post": {"summary": "Save report template","responses": {"201": {"description": "Created"}}}},
    "/api/reports/saved": {"get": {"summary": "List saved reports","responses": {"200": {"description": "OK"}}}},
    "/api/reports/fields": {"get": {"summary": "List table fields","responses": {"200": {"description": "OK"}}}},
    "/api/reports/export": {"get": {"summary": "Export table data","responses": {"200": {"description": "OK"}}}},
      "/api/menu/items": {
      "get": {"summary": "List menu items","responses": {"200": {"description": "OK"}}},
      "post": {"summary": "Create menu item","responses": {"201": {"description": "Created"}}}
    },
    "/api/orders": {"post": {"summary": "Create order","responses": {"201": {"description": "Created"}}}},
    "/api/orders/{id}": {"patch": {"summary": "Update order","responses": {"200": {"description": "OK"}}}},
    "/api/payments/qr": {"post": {"summary": "Generate QR payment","responses": {"201": {"description": "Created"}}}},
        "/api/orders/{id}/bill": {"get": {"summary": "Get order bill","responses": {"200": {"description": "OK"}}}},
    "/api/orders/{id}/split": {"post": {"summary": "Split bill","responses": {"200": {"description": "OK"}}}},
    "/api/orders/{id}/tip": {"post": {"summary": "Add tip","responses": {"200": {"description": "OK"}}}},
    "/api/payments/qr": {"post": {"summary": "Generate QR payment","responses": {"201": {"description": "Created"}}}},
    "/api/payments/link": {"post": {"summary": "Create payment link","responses": {"201": {"description": "Created"}}}},
    "/api/payments/tap": {"post": {"summary": "SoftPOS tap payment","responses": {"201": {"description": "Created"}}}},
    "/api/analytics/restaurant": {"get": {"summary": "Restaurant analytics metrics","responses": {"200": {"description": "OK"}}}},
       "/api/accounting/entries": {"get": {"summary": "Export accounting entries","responses": {"200": {"description": "OK"}}}}
  },
  "components": {
    "schemas": {
      "Trade": {
        "type": "object",
        "properties": {
          "id": { "type": "integer" },
          "trade_type": {
            "type": "string",
            "enum": [
              "loan_sale",
              "participation",
              "syndication_assignment",
              "portfolio_sale",
              "repo",
              "reverse_repo",
              "securitization_allocation",
              "debt_facility_draw"
            ]
          },
          "notional_amount": { "type": "number" },
          "symbol": { "type": "string" },
          "quantity": { "type": "number" },
          "price": { "type": "number" },
          "side": { "type": "string" },
          "counterparties": { "type": "array", "items": { "type": "string" } },
          "repo_rate_bps": { "type": "number" },
          "term_days": { "type": "integer" },
          "collateral_ref": { "type": "string" },
          "tranche_id": { "type": "string" },
          "waterfall_config": { "type": "object" },
          "facility_line_id": { "type": "string" },
          "status": { "type": "string" },
          "created_at": { "type": "string", "format": "date-time" },
           "settled_at": { "type": "string", "format": "date-time" },
          "compliance_flags": { "type": "array", "items": { "type": "object" } }
        },
         "required": ["id", "trade_type", "notional_amount", "symbol", "quantity", "status", "created_at"]
      },
      "TradeInput": {
        "type": "object",
        "properties": {
          "trade_type": {
            "type": "string",
            "enum": [
              "loan_sale",
              "participation",
              "syndication_assignment",
              "portfolio_sale",
              "repo",
              "reverse_repo",
              "securitization_allocation",
              "debt_facility_draw"
            ]
          },
          "notional_amount": { "type": "number" },
          "symbol": { "type": "string" },
          "quantity": { "type": "number" },
          "price": { "type": "number" },
          "side": { "type": "string" },
          "counterparties": { "type": "array", "items": { "type": "string" } },
                    "counterparty_profiles": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "wallet_address": { "type": "string" },
                "jurisdiction": { "type": "string" },
                "investor_type": { "type": "string" },
                "kycApproved": { "type": "boolean" }
              }
            }
          },
          "repo_rate_bps": { "type": "number" },
          "term_days": { "type": "integer" },
          "collateral_ref": { "type": "string" },
          "tranche_id": { "type": "string" },
          "waterfall_config": { "type": "object" },
          "facility_line_id": { "type": "string" }
        },
         "required": ["trade_type", "notional_amount", "symbol", "quantity", "price", "side", "counterparties"]
      }
    }
  }
}
