import { supabase } from '../../lib/supabaseClient';
import { postAndDistributeFunds } from './postAndDistributeFunds';

// Triggered by webhook or polling job
export async function handleACHDeposit(achData) {
  const { loan_id, amount, date_received } = achData;

  await supabase.from('payments').insert({
    loan_id,
    amount,
    method: 'ACH',
    status: 'Received',
    date_received
  });

  // Initiate fund posting and allocation
  await postAndDistributeFunds(loan_id, amount);
}
